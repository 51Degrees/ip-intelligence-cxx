<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees IP Intelligence C/C++: IpIntelligence/ReloadFromFile.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="/documentation/4.5/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees IP Intelligence C/C++
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">IP intelligence services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_ip_intelligence_2_reload_from_file_8c-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">IpIntelligence/ReloadFromFile.c</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>Reload from file example of using 51Degrees IP intelligence.This example illustrates how to use a single reference to the resource manager to use 51Degrees on-premise IP intelligence and invoke the reload functionality instead of maintaining a reference to the dataset directly.</p>
<p>This example is available in full on <a href="https://github.com/51Degrees/ip-intelligence-cxx/tree/main/examples/C/IpIntelligence/ReloadFromFile.c">GitHub</a>.</p>
<p>In detail, this example shows how to:</p>
<ol type="1">
<li>Only maintain a reference to the <a class="el" href="structfiftyone_degrees_resource_manager.html" title="Manager structure used to provide access to a shared and changing resource.">fiftyoneDegreesResourceManager</a> and use the reference to access dataset.</li>
<li>Use the <a class="el" href="group___fifty_one_degrees_ip_intelligence_api.html#ga7ca9bd3c704910d1e64ca2dc539f29d8" title="Reload the data set being used by the resource manager using the data file location which was used wh...">fiftyoneDegreesIpiReloadManagerFromOriginalFile</a> function to reload the dataset from the same location and with the same set of properties.</li>
<li>Retrieve a results instance from the data set and release it when done with detecting current IP Address.</li>
<li>Use the reload functionality in a single threaded environment.</li>
<li>Use the reload functionality in a multi threaded environment.</li>
</ol>
<p>The <a class="el" href="group___fifty_one_degrees_ip_intelligence_api.html#ga7ca9bd3c704910d1e64ca2dc539f29d8" title="Reload the data set being used by the resource manager using the data file location which was used wh...">fiftyoneDegreesIpiReloadManagerFromOriginalFile</a> function requires an existing resource with the initialized dataset. Function reloads the dataset from the same location and with the same parameters as the original dataset.</p>
<p>Please keep in mind that even if the current dataset was constructed with all available properties this does not guarantee that the new dataset will be initialized with the same set of properties. If the new data file contains properties that were not part of the original data file, the new extra property(ies) will not be initialized. If the new data file does not contain one or more property that were previously available, then these property(ies) will not be initialized.</p>
<p>Each successful data file reload should be accompanied by the integrity check to verify that the properties you want have indeed been loaded. This can be achieved by simply comparing the number of properties before and after the reload as the number can not go up but it can go down.</p>
<p>The reload functionality works both with the single threaded as well as the multi threaded modes. To try the reload functionality in single threaded mode build with FIFTYONE_DEGREES_NO_THREADING defined. Or build without FIFTYONE_DEGREES_NO_THREADING for multi threaded example.</p>
<p>In a single threaded environment the reload function is executed as part of the normal flow of the program execution and will prevent any other actions until the reload is complete.</p>
<p>Expected output: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">...</div><div class="c-code__line">Finished with hash code <span class="c-code__stringliteral">&#39;548397166&#39;</span></div><div class="c-code__line">Finished with hash code <span class="c-code__stringliteral">&#39;548397166&#39;</span></div><div class="c-code__line">Finished with hash code <span class="c-code__stringliteral">&#39;548397166&#39;</span></div><div class="c-code__line">Finished with hash code <span class="c-code__stringliteral">&#39;548397166&#39;</span></div><div class="c-code__line">Reloaded <span class="c-code__stringliteral">&#39;17&#39;</span> times.</div><div class="c-code__line">Failed to reload <span class="c-code__charliteral">&#39;0&#39;</span> times.</div><div class="c-code__line">...</div></div><div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;stdio.h&gt;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;Windows.h&gt;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#else</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;unistd.h&gt;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line"><span class="c-code__preprocessor">#define _CRTDBG_MAP_ALLOC</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;crtdbg.h&gt;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../Base/ExampleBase.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/common-cxx/textfile.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/ipi.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/fiftyone.h&quot;</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#define THREAD_COUNT 4</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* dataDir = <span class="c-code__stringliteral">&quot;ip-intelligence-data&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* dataFileName = <span class="c-code__stringliteral">&quot;51Degrees-LiteV41.ipi&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* ipAddressFileName = <span class="c-code__stringliteral">&quot;evidence.yml&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#define CONFIG fiftyoneDegreesIpiInMemoryConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesIpiHighPerformanceConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesIpiLowMemoryConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesIpiBalancedConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesIpiBalancedTempConfig</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">typedef</span> <span class="c-code__keyword">struct </span>shared_state_t {</div><div class="c-code__line">    <a name="_a0"></a><a class="code" href="class_resource_manager.html">ResourceManager</a>* manager; </div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* ipAddressFilePath; </div><div class="c-code__line">    <span class="c-code__keyword">volatile</span> <span class="c-code__keywordtype">long</span> threadsFinished; </div><div class="c-code__line">    <a name="a1"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga2b2e4a3c09db701069f4e529ebde6402">THREAD</a> threads[THREAD_COUNT]; </div><div class="c-code__line">} <a name="_a2"></a><a class="code" href="structshared_state.html">sharedState</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">typedef</span> <span class="c-code__keyword">struct </span>thread_state_t {</div><div class="c-code__line">    <a class="code" href="class_resource_manager.html">ResourceManager</a>* manager; </div><div class="c-code__line">    <span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span> hashCode; </div><div class="c-code__line">} <a name="_a3"></a><a class="code" href="structthread_state.html">threadState</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span> generateHash(<span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">char</span>* value) {</div><div class="c-code__line">    <span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span> hashCode = 5381;</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> i;</div><div class="c-code__line">    <span class="c-code__keywordflow">while</span> ((i = *value++)) {</div><div class="c-code__line">        hashCode = ((hashCode &lt;&lt; 5) + hashCode) + i;</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> hashCode;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span> getHashCode(<a name="_a4"></a><a class="code" href="structfiftyone_degrees_result_ipi_array.html">ResultsIpi</a>* results) {</div><div class="c-code__line">    <a name="a5"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <a name="_a6"></a><a class="code" href="structfiftyone_degrees_profile_percentage.html">ProfilePercentage</a>* valueItem;</div><div class="c-code__line">    <span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span> hashCode = 0;</div><div class="c-code__line">    uint32_t requiredPropertyIndex;</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* valueName;</div><div class="c-code__line">    <a name="_a7"></a><a class="code" href="structfiftyone_degrees_data_set_ipi.html">DataSetIpi</a>* dataSet = (<a class="code" href="structfiftyone_degrees_data_set_ipi.html">DataSetIpi</a>*)results-&gt;<a name="a8"></a>b.<a name="a9"></a><a class="code" href="structfiftyone_degrees_results_base.html#acb1eb8a8fb245ea49299b19fd71fa1d5">dataSet</a>;</div><div class="c-code__line">    for (requiredPropertyIndex = 0;</div><div class="c-code__line">        requiredPropertyIndex &lt; dataSet-&gt;<a name="a10"></a><a class="code" href="structfiftyone_degrees_data_set_ipi.html#ad52deae586ffdd6fbb1002891ba2c016">b</a>.<a name="a11"></a><a class="code" href="structfiftyone_degrees_data_set_ipi_base.html#a4a43833742ee8d3e83bf325a68fab225">b</a>.<a name="a12"></a><a class="code" href="structfiftyone_degrees_data_set_base.html#afb6fe7080fd386b7b4233ce5c87ce3c2">available</a>-&gt;<a name="a13"></a><a class="code" href="structfiftyone_degrees_property_available_array.html#a931e016a455f0ace924c2df65db6a54e">count</a>;</div><div class="c-code__line">        requiredPropertyIndex++) {</div><div class="c-code__line">        <a name="a14"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gaacb9726c834f22e01fe46c38117de6c3">EXCEPTION_CLEAR</a>;</div><div class="c-code__line">        <span class="c-code__keywordflow">if</span> (ResultsIpiGetHasValues(</div><div class="c-code__line">            results,</div><div class="c-code__line">            requiredPropertyIndex,</div><div class="c-code__line">            exception) == <span class="c-code__keyword">true</span>) {</div><div class="c-code__line">            <a name="a15"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">            valueItem = ResultsIpiGetValues(</div><div class="c-code__line">                results,</div><div class="c-code__line">                requiredPropertyIndex,</div><div class="c-code__line">                exception);</div><div class="c-code__line">            <a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">            valueName = <a name="a16"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga0f4d394a3ab4e09bff60f714c66dc5ee">STRING</a>(valueItem-&gt;<a name="a17"></a><a class="code" href="structfiftyone_degrees_profile_percentage.html#aee14483e40a7166bd28bb21c687bd045">item</a>.<a name="a18"></a><a class="code" href="structfiftyone_degrees_collection_item.html#a2a6c691d3e58694438f2b5575a2d7f08">data</a>.<a name="a19"></a><a class="code" href="structfiftyone_degrees_data.html#a838d52f2eb8fdc33d239ce30fe4f1fe5">ptr</a>); <span class="c-code__comment">// FIXME: value may not be a string</span></div><div class="c-code__line">            hashCode ^= generateHash((<span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">char</span>*)(valueName));</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> hashCode;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> executeTest(<span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* ipAddress, <span class="c-code__keywordtype">void</span>* state) {</div><div class="c-code__line">    <a class="code" href="structthread_state.html">threadState</a>* thread = (<a class="code" href="structthread_state.html">threadState</a>*)state;</div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_result_ipi_array.html">ResultsIpi</a>* results = ResultsIpiCreate(</div><div class="c-code__line">        thread-&gt;<a name="a20"></a><a class="code" href="structthread_state.html#a8e806850d1345f9bc7c571ebec248b6b">manager</a>);</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line">    ResultsIpiFromIpAddressString(</div><div class="c-code__line">        results,</div><div class="c-code__line">        ipAddress,</div><div class="c-code__line">        strlen(ipAddress),</div><div class="c-code__line">        exception);</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">    thread-&gt;<a name="a21"></a><a class="code" href="structthread_state.html#a12fe1cfd5e3ee1d09897b894b281c71c">hashCode</a> ^= getHashCode(results);</div><div class="c-code__line">    ResultsIpiFree(results);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> runRequestsSingle(<a class="code" href="structshared_state.html">sharedState</a>* state) {</div><div class="c-code__line">    <a class="code" href="structshared_state.html">sharedState</a>* <span class="c-code__keyword">const</span> shared = (<a class="code" href="structshared_state.html">sharedState</a>*)state;</div><div class="c-code__line">    <a class="code" href="structthread_state.html">threadState</a> thread;</div><div class="c-code__line">    thread.<a class="code" href="structthread_state.html#a12fe1cfd5e3ee1d09897b894b281c71c">hashCode</a> = 0;</div><div class="c-code__line">    thread.<a class="code" href="structthread_state.html#a8e806850d1345f9bc7c571ebec248b6b">manager</a> = shared-&gt;<a name="a22"></a><a class="code" href="structshared_state.html#a515e8283f542961d5d9a7eead2028f7f">manager</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keyword">const</span> uint32_t ipsCount = fiftyoneDegreesIterateFakeIPv4s(</div><div class="c-code__line">        0x00000000U,</div><div class="c-code__line">        0xFFFFE381U,</div><div class="c-code__line">        0x00068DB8U,</div><div class="c-code__line">        executeTest,</div><div class="c-code__line">        &amp;thread);</div><div class="c-code__line"></div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Finished &#39;%lu&#39; addresses with hash code &#39;%lu&#39;\r\n&quot;</span>,</div><div class="c-code__line">        (<span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span>)ipsCount, (<span class="c-code__keywordtype">unsigned</span> <span class="c-code__keywordtype">long</span>)thread.<a class="code" href="structthread_state.html#a12fe1cfd5e3ee1d09897b894b281c71c">hashCode</a>);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> runRequestsMulti(<span class="c-code__keywordtype">void</span>* state) {</div><div class="c-code__line">    <a class="code" href="structshared_state.html">sharedState</a>* shared = (<a class="code" href="structshared_state.html">sharedState</a>*)state;</div><div class="c-code__line">    runRequestsSingle(shared);</div><div class="c-code__line">    <a name="a23"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga3ea681c531ebbbab44f6535ae1e7401a">INTERLOCK_INC</a>(&amp;shared-&gt;<a name="a24"></a><a class="code" href="structshared_state.html#a6b06c2dc5f1bdaddf5c23509e28c207f">threadsFinished</a>);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> startThreads(<a class="code" href="structshared_state.html">sharedState</a>* state) {</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> thread;</div><div class="c-code__line">    <span class="c-code__keywordflow">for</span> (thread = 0; thread &lt; THREAD_COUNT; thread++) {</div><div class="c-code__line">        <a name="a25"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gaa519320c3a94b1baf8495a3c45686b01">THREAD_CREATE</a>(</div><div class="c-code__line">            state-&gt;<a name="a26"></a><a class="code" href="structshared_state.html#a495e1e559762cb3edd7fba124b3b74f4">threads</a>[thread],</div><div class="c-code__line">            (<a name="a27"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gac3b1b7914c03617e93bcc720b3b63535">THREAD_ROUTINE</a>)&amp;runRequestsMulti,</div><div class="c-code__line">            state);</div><div class="c-code__line">    }</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> joinThreads(<a class="code" href="structshared_state.html">sharedState</a>* state) {</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> thread;</div><div class="c-code__line">    <span class="c-code__keywordflow">for</span> (thread = 0; thread &lt; THREAD_COUNT; thread++) {</div><div class="c-code__line">        <a name="a28"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga8780bffcae60e8593485d281e4914545">THREAD_JOIN</a>(state-&gt;<a class="code" href="structshared_state.html#a495e1e559762cb3edd7fba124b3b74f4">threads</a>[thread]);</div><div class="c-code__line">        <a name="a29"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gad09cd47e11c1d05e201237e0deadd1d2">THREAD_CLOSE</a>(state-&gt;<a class="code" href="structshared_state.html#a495e1e559762cb3edd7fba124b3b74f4">threads</a>[thread]);</div><div class="c-code__line">    }</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> reportStatus(</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* fileName) {</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* message = <a name="a30"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga3002890a18e3a86e4078880f2b00bbad">StatusGetMessage</a>(status, fileName);</div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;%s\n&quot;</span>, message);</div><div class="c-code__line">    <a name="a31"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gae0ecd1fc988dbb64ff0232a001e090bf">Free</a>((<span class="c-code__keywordtype">void</span>*)message);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> run(</div><div class="c-code__line">    <a class="code" href="class_resource_manager.html">ResourceManager</a>* manager,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* ipAddressFilePath) {</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status;</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> numberOfReloads = 0;</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> numberOfReloadFails = 0;</div><div class="c-code__line">    <a class="code" href="structshared_state.html">sharedState</a> state;</div><div class="c-code__line">    state.<a class="code" href="structshared_state.html#a515e8283f542961d5d9a7eead2028f7f">manager</a> = manager;</div><div class="c-code__line">    state.<a name="a32"></a><a class="code" href="structshared_state.html#a5fdd2261ab3dbe9ecf6d558a847da5b6">ipAddressFilePath</a> = ipAddressFilePath;</div><div class="c-code__line">    state.<a class="code" href="structshared_state.html#a6b06c2dc5f1bdaddf5c23509e28c207f">threadsFinished</a> = 0;</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (<a name="a33"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga03649d9fd49fb4489d4728fb70fa404b">ThreadingGetIsThreadSafe</a>()) {</div><div class="c-code__line">        printf(<span class="c-code__stringliteral">&quot;** Multi Threaded Reload Example **\r\n&quot;</span>);</div><div class="c-code__line">        startThreads(&amp;state);</div><div class="c-code__line">        <span class="c-code__keywordflow">while</span> (state.<a class="code" href="structshared_state.html#a6b06c2dc5f1bdaddf5c23509e28c207f">threadsFinished</a> &lt; THREAD_COUNT) {</div><div class="c-code__line">            status = IpiReloadManagerFromOriginalFile(</div><div class="c-code__line">                manager,</div><div class="c-code__line">                exception);</div><div class="c-code__line">            <a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (status == <a name="a34"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">                numberOfReloads++;</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">                numberOfReloadFails++;</div><div class="c-code__line">            }</div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line">            Sleep(1000); <span class="c-code__comment">// milliseconds</span></div><div class="c-code__line"><span class="c-code__preprocessor">#else</span></div><div class="c-code__line">            usleep(1000000); <span class="c-code__comment">// microseconds</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line">        }</div><div class="c-code__line">        joinThreads(&amp;state);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        printf(<span class="c-code__stringliteral">&quot;** Single Threaded Reload Example **\r\n&quot;</span>);</div><div class="c-code__line">        runRequestsSingle(&amp;state);</div><div class="c-code__line">        status = IpiReloadManagerFromOriginalFile(</div><div class="c-code__line">            manager,</div><div class="c-code__line">            exception);</div><div class="c-code__line">        <a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">        <span class="c-code__keywordflow">if</span> (status == <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">            numberOfReloads++;</div><div class="c-code__line">        }</div><div class="c-code__line">        <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">            numberOfReloadFails++;</div><div class="c-code__line">        }</div><div class="c-code__line">        runRequestsSingle(&amp;state);</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Report the number of reloads.</span></div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Reloaded &#39;%i&#39; times.\r\n&quot;</span>, numberOfReloads);</div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Failed to reload &#39;%i&#39; times.\r\n&quot;</span>, numberOfReloadFails);</div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Program execution complete. Press Return to exit.&quot;</span>);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordtype">void</span> fiftyoneDegreesIpiReloadFromFileRun(</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* dataFilePath,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* ipAddressFilePath,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* requiredProperties,</div><div class="c-code__line">    <a name="_a35"></a><a class="code" href="structfiftyone_degrees_config_ipi.html">ConfigIpi</a> config) {</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set the required properties to the string provided in the arguments.</span></div><div class="c-code__line">    <a name="_a36"></a><a class="code" href="structfiftyone_degrees_properties_required.html">PropertiesRequired</a> reqProps = <a name="a37"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga246be0840df800ead0edc55949e2e92e">PropertiesDefault</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set the required properties for hashing each test thread.</span></div><div class="c-code__line">    reqProps.<a name="a38"></a><a class="code" href="structfiftyone_degrees_properties_required.html#a7044785e8c67e2d208ba1010ec355d5c">string</a> = requiredProperties;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set concurrency to ensure sufficient shared resources available.</span></div><div class="c-code__line">    config.<a name="a39"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#a0d6715d257f229a245ed98af74dc687f">graph</a>.<a name="a40"></a><a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a41"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#a3b7f39c699808c56fdf5965b9d8a8528">graphs</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a42"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#a2e4fba12e06d21ce1e2177ada9496835">components</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a43"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#acc29ddb134dfc526fc8f0c6ef09ce039">properties</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a44"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#aeadb0e7ead1a298a085a525530d63571">profiles</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a45"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#acf10229723ecf8259873dedc47e27ff0">profileOffsets</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a46"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#ab02bc4f15ac896e3f0ac1e8c676ef2fc">values</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a47"></a><a class="code" href="structfiftyone_degrees_config_ipi.html#aad06a53290f7ac8a08a393a3f6d9e676">strings</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> = THREAD_COUNT;</div><div class="c-code__line"></div><div class="c-code__line">    <a class="code" href="class_resource_manager.html">ResourceManager</a> manager;</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status = IpiInitManagerFromFile(</div><div class="c-code__line">        &amp;manager,</div><div class="c-code__line">        &amp;config,</div><div class="c-code__line">        &amp;reqProps,</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        exception);</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Free the memory used for the required properties if allocated.</span></div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (requiredProperties != reqProps.<a class="code" href="structfiftyone_degrees_properties_required.html#a7044785e8c67e2d208ba1010ec355d5c">string</a>) {</div><div class="c-code__line">        free((<span class="c-code__keywordtype">void</span>*)reqProps.<a class="code" href="structfiftyone_degrees_properties_required.html#a7044785e8c67e2d208ba1010ec355d5c">string</a>);</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, dataFilePath);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Run the performance tests.</span></div><div class="c-code__line">        run(&amp;manager, ipAddressFilePath);</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Free the memory used by the data set.</span></div><div class="c-code__line">        <a name="a48"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gac5094875841e9d95dc972014124ea765">ResourceManagerFree</a>(&amp;manager);</div><div class="c-code__line">    }</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifndef TEST</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordtype">int</span> main(<span class="c-code__keywordtype">int</span> argc, <span class="c-code__keywordtype">char</span>* argv[]) {</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Memory leak detection code.</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line">    _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);</div><div class="c-code__line">    _CrtSetReportFile(_CRT_WARN, _CRTDBG_FILE_STDERR);</div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status = <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> dataFilePath[<a name="a49"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gafd3ee670ff4ed3f29a395abd2f0f3344">FILE_MAX_PATH</a>];</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> ipAddressFilePath[<a class="code" href="group___fifty_one_degrees_synonyms.html#gafd3ee670ff4ed3f29a395abd2f0f3344">FILE_MAX_PATH</a>];</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (argc &gt; 1) {</div><div class="c-code__line">        strcpy(dataFilePath, argv[1]);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        status = <a name="a50"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga5ba06bcfd18437e9145833037dd7ecc9">FileGetPath</a>(</div><div class="c-code__line">            dataDir,</div><div class="c-code__line">            dataFileName,</div><div class="c-code__line">            dataFilePath,</div><div class="c-code__line">            <span class="c-code__keyword">sizeof</span>(dataFilePath));</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, dataFileName);</div><div class="c-code__line">        fgetc(stdin);</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span> 1;</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (argc &gt; 2) {</div><div class="c-code__line">        strcpy(ipAddressFilePath, argv[2]);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        status = <a class="code" href="group___fifty_one_degrees_synonyms.html#ga5ba06bcfd18437e9145833037dd7ecc9">FileGetPath</a>(</div><div class="c-code__line">            dataDir,</div><div class="c-code__line">            ipAddressFileName,</div><div class="c-code__line">            ipAddressFilePath,</div><div class="c-code__line">            <span class="c-code__keyword">sizeof</span>(ipAddressFilePath));</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, ipAddressFilePath);</div><div class="c-code__line">        fgetc(stdin);</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span> 1;</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Run the performance test.</span></div><div class="c-code__line">    fiftyoneDegreesIpiReloadFromFileRun(</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        ipAddressFilePath,</div><div class="c-code__line">        argc &gt; 3 ? argv[3] : <span class="c-code__stringliteral">&quot;RegisteredName&quot;</span>,</div><div class="c-code__line">        CONFIG);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line">    _CrtDumpMemoryLeaks();</div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Wait for a character to be pressed.</span></div><div class="c-code__line">    fgetc(stdin);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> 0;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
