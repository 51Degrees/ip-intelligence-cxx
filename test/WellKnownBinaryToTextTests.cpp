/* *********************************************************************
 * This Original Work is copyright of 51 Degrees Mobile Experts Limited.
 * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,
 * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.
 *
 * This Original Work is licensed under the European Union Public Licence (EUPL) 
 * v.1.2 and is subject to its terms as set out below.
 *
 * If a copy of the EUPL was not distributed with this file, You can obtain
 * one at https://opensource.org/licenses/EUPL-1.2.
 *
 * The 'Compatible Licences' set out in the Appendix to the EUPL (as may be
 * amended by the European Commission) shall be deemed incompatible for
 * the purposes of the Work and the provisions of the compatibility
 * clause in Article 5 of the EUPL shall not apply.
 * 
 * If using the Work as, or as part of, a network application, by 
 * including the attribution notice(s) required under Article 5 of the EUPL
 * in the end user terms of the application under an appropriate heading, 
 * such notice(s) shall fulfill the requirements of that article.
 * ********************************************************************* */

#include "pch.h"
#include "../src/wkbtot.h"

static bool CheckResult(const char *result, const char *expected, uint16_t const size) {
	bool match = true;
	for (uint16_t i = 0; i < size; i++) {
		match = match && (*result == *expected);
		result++;
		expected++;
	}
	return match;
}

static size_t constexpr DEFAULT_BUFFER_SIZE = 1024;

static void convertAndCompare(
	const uint8_t * const wkbBytes,
	const char * const expected,
	const char * const comment) {
	char buffer[DEFAULT_BUFFER_SIZE] = { 0 };
	FIFTYONE_DEGREES_EXCEPTION_CREATE;

	auto const result = fiftyoneDegreesConvertWkbToWkt(
		wkbBytes,
		buffer, std::size(buffer),
		exception);

	EXPECT_TRUE(FIFTYONE_DEGREES_EXCEPTION_OKAY) <<
		"Got exception while converting WKB: " << fiftyoneDegreesExceptionGetMessage(exception);

	EXPECT_FALSE(result.bufferTooSmall) <<
		"Buffer was deemed too small, requested " << result.written <<
		", available " <<  std::size(buffer);

	EXPECT_TRUE(
		CheckResult(buffer, expected, strlen(expected))) <<
		"The value of " << comment << " is not correctly converted -- '" << buffer <<
		"' -- vs expected -- '" << expected << "'";
}

TEST(WKBToT, WKBToT_Point_2D_NDR)
{
	const uint8_t wkbBytes[] = {
		0x00, // big endian
      	0x00,0x00,0x00,0x01, // POINT (2D)
        0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00, // 2.0: x-coordinate
      	0x40,0x10,0x00,0x00,0x00,0x00,0x00,0x00, // 4.0: y-coordinate
    };
	const char * const expected = "Point (2 4)";

	convertAndCompare(wkbBytes, expected, "Point 2D (NDR)");
}

TEST(WKBToT, WKBToT_Point_2D_XDR)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x01, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x31, 0x40,
	};
	const char * const expected = "Point (3.5 17.25)";

	convertAndCompare(wkbBytes, expected, "Point 2D (XDR)");
}

TEST(WKBToT, WKBToT_LineStringZ_XDR)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xea, 0x03, 0x00, 0x00,
		0x04, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x26, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x4f, 0x40,
		0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0x8b, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x30, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xcf, 0x67, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x23, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x1d, 0x71, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x37, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x07, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd4, 0x3f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
	};
	const char * const expected = "LineString Z ("
	"2 11.125 63.0625, "
	"892.09375 16.28125 190.46875, "
	"9.59375 273.8125 23.15625, "
	"2.9375 0.3125 1)";

	convertAndCompare(wkbBytes, expected, "LineString Z (XDR)");
}

TEST(WKBToT, WKBToT_PolygonM_XDR)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xd3, 0x07, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 rings
		0x04, 0x00, 0x00, 0x00, // 4 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x26, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x4f, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x26, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x4f, 0x40,
		0x03, 0x00, 0x00, 0x00, // 3 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x8b, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x67, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x71, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x37, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
	};
	const char * const expected = "Polygon M ((2 -11 -63, -7 3 -5, 6 -9 17, -2 11 63), (892 16 190, 9 273 23, 2 0 1))";

	convertAndCompare(wkbBytes, expected, "Polygon M (XDR)");
}

TEST(WKBToT, WKBToT_TriangleZM_XDR)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xc9, 0x0b, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 rings
		0x03, 0x00, 0x00, 0x00, // 3 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xbf,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xbf,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x40,
		0x03, 0x00, 0x00, 0x00, // 3 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0xc0,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
	};
	const char * const expected = "Triangle ZM ((-1 -1 1 1, 2 -2 2 2, -2 2 3 3), (-10 -10 10 10, 20 -20 20 20, -20 20 30 30))";

	convertAndCompare(wkbBytes, expected, "Triangle ZM (XDR)");
}

TEST(WKBToT, WKBToT_Point2D_Simple)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x01, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
	};
	const char * const expected = "Point (10 10)";

	convertAndCompare(wkbBytes, expected, "Point 2D");
}

TEST(WKBToT, WKBToT_LineString)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x02, 0x00, 0x00, 0x00,
		0x03, 0x00, 0x00, 0x00, // 3 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x40,
	};
	const char * const expected = "LineString (10 10, 20 20, 30 40)";

	convertAndCompare(wkbBytes, expected, "LineString");
}

TEST(WKBToT, WKBToT_Polygon)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x03, 0x00, 0x00, 0x00,
		0x01, 0x00, 0x00, 0x00, // 1 rings
		0x05, 0x00, 0x00, 0x00, // 5 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
	};
	const char * const expected = "Polygon "
	"((10 10, 10 20, 20 20, 20 15, 10 10))";

	convertAndCompare(wkbBytes, expected, "Polygon");
}

TEST(WKBToT, WKBToT_MultiPoint)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x04, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 points
		0x01,
		0x01, 0x00, 0x00, 0x00, // point
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x01,
		0x01, 0x00, 0x00, 0x00, // point
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
	};
	const char * const expected = "MultiPoint ((10 10), (20 20))";

	convertAndCompare(wkbBytes, expected, "MultiPoint");
}

TEST(WKBToT, WKBToT_MultiLineString)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x05, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 lines
		0x01,
		0x02, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x01,
		0x02, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
	};
	const char * const expected = "MultiLineString "
	"("
	"(10 10, 20 20), (15 15, 30 15)"
	")";

	convertAndCompare(wkbBytes, expected, "MultiLineString");
}

TEST(WKBToT, WKBToT_MultiPolygon)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x06, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x00, 0x00, // 2 polygons
		0x01,
		0x03, 0x00, 0x00, 0x00,
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x01,
		0x03, 0x00, 0x00, 0x00,
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x04, 0x00, 0x00, 0x00, // 4 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x51, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x51, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x54, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x4e, 0x40,
	};
	const char * const expected = "MultiPolygon "
	"("
	"((10 10, 10 20, 20 20, 20 15, 10 10)), "
	"((60 60, 70 70, 80 60, 60 60))"
	")";

	convertAndCompare(wkbBytes, expected, "MultiPolygon");
}

TEST(WKBToT, WKBToT_GeometryCollection)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0x07, 0x00, 0x00, 0x00,
		0x03, 0x00, 0x00, 0x00, // 3 geometries
		0x01,
		0x01, 0x00, 0x00, 0x00, // point
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x01,
		0x01, 0x00, 0x00, 0x00, // point
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40,
		0x01,
		0x02, 0x00, 0x00, 0x00, // line string
		0x02, 0x00, 0x00, 0x00, // 2 points
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2e, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40,
	};
	const char * const expected = "GeometryCollection "
	"("
	"Point (10 10), "
	"Point (30 30), "
	"LineString (15 15, 20 20)"
	")";

	convertAndCompare(wkbBytes, expected, "GeometryCollection");
}

TEST(WKBToT, WKBToT_PolyhedronZ)
{
    const uint8_t wkbBytes[] = {
        0x01,
        0xf7, 0x03, 0x00, 0x00,
        0x06, 0x00, 0x00, 0x00, // 6 polygons
        0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
    	0x01, 0x00, 0x00, 0x00, // 1 ring
        0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x05, 0x00, 0x00, 0x00, // 5 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
    };
	const char * const expected = "PolyhedralSurface Z "
	"("
	"((0 0 0, 0 0 1, 0 1 1, 0 1 0, 0 0 0)), "
	"((0 0 0, 0 1 0, 1 1 0, 1 0 0, 0 0 0)), "
	"((0 0 0, 1 0 0, 1 0 1, 0 0 1, 0 0 0)), "
	"((1 1 0, 1 1 1, 1 0 1, 1 0 0, 1 1 0)), "
	"((0 1 0, 0 1 1, 1 1 1, 1 1 0, 0 1 0)), "
	"((0 0 1, 1 0 1, 1 1 1, 0 1 1, 0 0 1))"
	")";

	convertAndCompare(wkbBytes, expected, "PolyhedralSurface Z");
}

TEST(WKBToT, WKBToT_TinZ)
{
    const uint8_t wkbBytes[] = {
        0x01,
        0xf8, 0x03, 0x00, 0x00,
        0x04, 0x00, 0x00, 0x00, // 4 polygons
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
        0x04, 0x00, 0x00, 0x00, // 4 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x04, 0x00, 0x00, 0x00, // 4 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x04, 0x00, 0x00, 0x00, // 4 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    	0x01,
        0xeb, 0x03, 0x00, 0x00, // polygon z
		0x01, 0x00, 0x00, 0x00, // 1 ring
		0x04, 0x00, 0x00, 0x00, // 4 points
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };
	const char * const expected = "Tin Z ("
	"((0 0 0, 0 0 1, 0 1 0, 0 0 0)), "
	"((0 0 0, 0 1 0, 1 0 0, 0 0 0)), "
	"((0 0 0, 1 0 0, 0 0 1, 0 0 0)), "
	"((1 0 0, 0 1 0, 0 0 1, 1 0 0))"
	")";

	convertAndCompare(wkbBytes, expected, "Tin Z");
}

TEST(WKBToT, WKBToT_PointZ)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xe9, 0x03, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x40,
	};
	const char * const expected = "Point Z (10 10 5)";

	convertAndCompare(wkbBytes, expected, "Point Z");
}

TEST(WKBToT, WKBToT_PointZM)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xb9, 0x0b, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x40,
	};
	const char * const expected = "Point ZM (10 10 5 40)";

	convertAndCompare(wkbBytes, expected, "Point ZM");
}

TEST(WKBToT, WKBToT_PointM)
{
	const uint8_t wkbBytes[] = {
		0x01,
		0xd1, 0x07, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x40,
	};
	const char * const expected = "Point M (10 10 40)";

	convertAndCompare(wkbBytes, expected, "Point M");
}
